{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemata.nostr.watch/note/kind/9902",
  "title": "Reservation Response Event (Kind 9902)",
  "description": "Full event schema for reservation.response (kind 9902) - unsigned rumor event (no sig field, per NIP-59)",
  "allOf": [
    {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "Deterministic event hash as defined in NIP-01"
        },
        "content": {
          "type": "string",
          "description": "The content of the note"
        },
        "created_at": {
          "type": "integer",
          "description": "The timestamp of the note creation"
        },
        "kind": {
          "type": "integer"
        },
        "pubkey": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "The public key of the note's author"
        },
        "tags": {
          "type": "array",
          "description": "The tags of the note",
          "items": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string"
            }
          }
        }
      },
      "required": [
        "content",
        "created_at",
        "kind",
        "tags"
      ],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "kind": {
          "const": 9902,
          "description": "Kind 9902 identifies a reservation response"
        },
        "id": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "Deterministic event hash as defined in NIP-01"
        },
        "pubkey": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "Sender public key"
        },
        "content": {
          "type": "string",
          "description": "Reservation response message in plain text"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string"
            }
          },
          "minItems": 1,
          "allOf": [
            {
              "contains": {
                "type": "array",
                "minItems": 2,
                "maxItems": 3,
                "items": [
                  {
                    "const": "p",
                    "description": "Tag identifier"
                  },
                  {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$",
                    "description": "Recipient public key"
                  },
                  {
                    "type": "string",
                    "description": "Recommended relay URL (optional)"
                  }
                ],
                "additionalItems": false
              }
            },
            {
              "contains": {
                "type": "array",
                "minItems": 4,
                "maxItems": 4,
                "items": [
                  {
                    "const": "e",
                    "description": "Tag identifier"
                  },
                  {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$",
                    "description": "Unsigned rumor ID of the original reservation.request (kind 9901) - connects message to reservation thread"
                  },
                  {
                    "const": "",
                    "description": "Empty string (relay URL not needed for rumors)"
                  },
                  {
                    "const": "root",
                    "description": "Marker indicating this references the root event"
                  }
                ],
                "additionalItems": false
              }
            },
            {
              "contains": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": [
                  {
                    "const": "status",
                    "description": "Tag identifier"
                  },
                  {
                    "type": "string",
                    "enum": [
                      "confirmed",
                      "declined",
                      "cancelled"
                    ],
                    "description": "Status of the reservation"
                  }
                ],
                "additionalItems": false
              }
            },
            {
              "contains": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": [
                  {
                    "const": "time",
                    "description": "Tag identifier"
                  },
                  {
                    "type": "string",
                    "pattern": "^[0-9]+$",
                    "description": "Inclusive reservation start Unix timestamp in seconds"
                  }
                ],
                "additionalItems": false
              }
            },
            {
              "contains": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": [
                  {
                    "const": "tzid",
                    "description": "Tag identifier"
                  },
                  {
                    "type": "string",
                    "description": "Time zone of the reservation time Unix timestamp, as defined by the IANA Time Zone Database (e.g., America/Costa_Rica)"
                  }
                ],
                "additionalItems": false
              }
            },
            {
              "contains": {
                "type": "array",
                "minItems": 2,
                "maxItems": 2,
                "items": [
                  {
                    "const": "duration",
                    "description": "Tag identifier"
                  },
                  {
                    "type": "string",
                    "pattern": "^[0-9]+$",
                    "description": "Duration of reservation in seconds (optional)"
                  }
                ],
                "additionalItems": false
              }
            }
          ]
        }
      },
      "required": [
        "kind",
        "id",
        "pubkey"
      ]
    },
    {
      "not": {
        "required": [
          "sig"
        ]
      }
    }
  ]
}